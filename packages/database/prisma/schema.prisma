// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===========================================
// AUTHENTICATION & USERS
// ===========================================

enum UserRole {
  USER
  ADMIN
  DISPLAY
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING
}

model User {
  id           String     @id @default(cuid())
  email        String     @unique
  passwordHash String     @map("password_hash")
  name         String
  username     String?    @unique // @username único para perfil
  bio          String?    // Bio do perfil (max 150 chars)
  avatarUrl    String?    @map("avatar_url")
  phone        String?
  role         UserRole   @default(USER)
  status       UserStatus @default(PENDING)
  isVerified   Boolean    @default(false) @map("is_verified")
  verifiedAt   DateTime?  @map("verified_at")
  lastLoginAt  DateTime?  @map("last_login_at")

  // Associação
  associationId String      @map("association_id")
  association   Association @relation(fields: [associationId], references: [id])
  memberId      String?     @unique @map("member_id") // ID da carteirinha

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  refreshTokens      RefreshToken[]
  points             UserPoints?
  transactions       PointTransaction[]
  subscriptions      UserSubscription[]
  badges             UserBadge[]
  stravaConnection   StravaConnection?
  card               MemberCard?
  cardUsages         CardUsageLog[]
  eventConfirmations EventConfirmation[]
  eventCheckIns      EventCheckIn[]
  eventComments      EventComment[]

  // Phase 4 - Notifications & Messages
  notifications         Notification[]
  notificationSettings  NotificationSettings[]
  doNotDisturbSettings  DoNotDisturbSettings?
  deviceTokens          DeviceToken[]
  conversationParticipants ConversationParticipant[]
  messagesSent          Message[]
  messageReactions      MessageReaction[]
  groupsCreated         ConversationGroup[]

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String   @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("refresh_tokens")
}

// ===========================================
// ASSOCIATION
// ===========================================

model Association {
  id             String  @id @default(cuid())
  name           String
  slug           String  @unique
  logoUrl        String? @map("logo_url")
  primaryColor   String  @default("#6366F1") @map("primary_color")
  secondaryColor String  @default("#8B5CF6") @map("secondary_color")
  pointsName     String  @default("pontos") @map("points_name") // customizable currency name

  // Configs
  cashbackPercent Float @default(5.0) @map("cashback_percent")
  stravaMaxKmDay  Float @default(5.0) @map("strava_max_km_day")

  // Contact info (for card back side)
  phone   String?
  email   String?
  website String?
  address String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  users             User[]
  pointsConfig      PointsConfig?
  subscriptionPlans SubscriptionPlan[]
  partners          Partner[]
  partnerCategories PartnerCategory[]
  events            Event[]

  @@map("associations")
}

// ===========================================
// POINTS SYSTEM (Phase 1)
// ===========================================

model PointsConfig {
  id            String      @id @default(cuid())
  associationId String      @unique @map("association_id")
  association   Association @relation(fields: [associationId], references: [id])

  // Points per action
  checkInPoints   Int @default(50) @map("check_in_points")
  dailyPostPoints Int @default(5) @map("daily_post_points")
  referralPoints  Int @default(500) @map("referral_points")

  // Strava config
  stravaRunPointsPerKm  Int      @default(10) @map("strava_run_points_per_km")
  stravaRidePointsPerKm Int      @default(5) @map("strava_ride_points_per_km")
  stravaWalkPointsPerKm Int      @default(5) @map("strava_walk_points_per_km")
  stravaSwimPointsPerKm Int      @default(15) @map("strava_swim_points_per_km")
  stravaHikePointsPerKm Int      @default(8) @map("strava_hike_points_per_km")
  stravaDailyLimitKm    Float    @default(5.0) @map("strava_daily_limit_km")
  stravaEligibleTypes   String[] @default(["Run", "Ride", "Walk", "Swim", "Hike"]) @map("strava_eligible_types")
  stravaEnabled         Boolean  @default(true) @map("strava_enabled")
  dailyPostEnabled      Boolean  @default(true) @map("daily_post_enabled")

  // Conversion rates
  pointsToMoneyRate Float @default(0.50) @map("points_to_money_rate") // 1 point = R$ X

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("points_config")
}

// ===========================================
// STRAVA INTEGRATION
// ===========================================

model StravaConnection {
  id     String @id @default(cuid())
  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  athleteId      Int      @map("athlete_id")
  athleteName    String?  @map("athlete_name")
  accessToken    String   @map("access_token") // encrypted
  refreshToken   String   @map("refresh_token") // encrypted
  tokenExpiresAt DateTime @map("token_expires_at")

  lastSyncAt  DateTime? @map("last_sync_at")
  kmUsedToday Float     @default(0) @map("km_used_today")
  kmUsedDate  DateTime? @map("km_used_date") // reset daily

  connectedAt DateTime @default(now()) @map("connected_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  activities StravaActivity[]

  @@map("strava_connections")
}

model StravaActivity {
  id           String           @id @default(cuid())
  connectionId String           @map("connection_id")
  connection   StravaConnection @relation(fields: [connectionId], references: [id], onDelete: Cascade)

  stravaActivityId BigInt   @unique @map("strava_activity_id")
  name             String
  type             String // Run, Ride, Walk, Swim, Hike
  distanceKm       Float    @map("distance_km")
  kmCredited       Float    @map("km_credited")
  pointsEarned     Int      @map("points_earned")
  activityDate     DateTime @map("activity_date")
  syncedAt         DateTime @default(now()) @map("synced_at")

  @@index([connectionId, activityDate])
  @@map("strava_activities")
}

model UserPoints {
  id     String @id @default(cuid())
  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  balance        Int @default(0)
  lifetimeEarned Int @default(0) @map("lifetime_earned")
  lifetimeSpent  Int @default(0) @map("lifetime_spent")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("user_points")
}

enum TransactionSource {
  // Credits
  EVENT_CHECKIN // Check-in at event
  STRAVA_ACTIVITY // Synced Strava activity
  DAILY_POST // First post of the day
  TRANSFER_IN // Received transfer
  SHOP_CASHBACK // Cashback from shop purchase (PIX/money)
  PDV_CASHBACK // Cashback from PDV purchase (PIX)
  ADMIN_CREDIT // Manual credit by admin

  // Debits
  SHOP_PURCHASE // Purchase in shop
  PDV_PURCHASE // Purchase in PDV (kiosk)
  JUKEBOX_PAYMENT // Jukebox payment
  TRANSFER_OUT // Sent transfer
  ADMIN_DEBIT // Manual debit by admin

  // Both
  REFUND // Refund (can be credit or debit)

  // Legacy (kept for compatibility)
  CHECK_IN
  STRAVA
  PURCHASE_POINTS
  PURCHASE_PIX
  CASHBACK
  SUBSCRIPTION_BONUS
  REFERRAL
  MANUAL_ADJUSTMENT
}

model PointTransaction {
  id     String @id @default(cuid())
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  amount      Int // positive = credit, negative = debit
  balance     Int // balance after transaction
  source      TransactionSource
  sourceId    String?           @map("source_id") // event_id, order_id, etc
  description String?
  metadata    Json? // extra data

  // For transfers
  relatedUserId String? @map("related_user_id")

  // For refunds
  refundedTransactionId String?           @unique @map("refunded_transaction_id")
  refundTransaction     PointTransaction? @relation("RefundRelation", fields: [refundedTransactionId], references: [id])
  refundedBy            PointTransaction? @relation("RefundRelation")

  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId, createdAt])
  @@index([userId, source])
  @@map("point_transactions")
}

// Track recent transfer recipients for quick access
model TransferRecipient {
  id             String   @id @default(cuid())
  userId         String   @map("user_id")
  recipientId    String   @map("recipient_id")
  lastTransferAt DateTime @map("last_transfer_at")
  transferCount  Int      @default(1) @map("transfer_count")

  @@unique([userId, recipientId])
  @@index([userId, lastTransferAt(sort: Desc)])
  @@map("transfer_recipients")
}

// ===========================================
// SUBSCRIPTIONS (Phase 1)
// ===========================================

model SubscriptionPlan {
  id            String      @id @default(cuid())
  associationId String      @map("association_id")
  association   Association @relation(fields: [associationId], references: [id])

  name         String
  description  String?
  priceMonthly Int     @map("price_monthly") // in cents
  iconUrl      String? @map("icon_url")
  color        String  @default("#6366F1")
  displayOrder Int     @default(0) @map("display_order")

  // Mutators as JSON for flexibility
  // { points_events: 1.5, points_strava: 1.5, points_posts: 2.0,
  //   discount_store: 10.0, discount_pdv: 10.0, discount_spaces: 15.0, cashback: 10.0 }
  mutators Json @default("{}")

  // Legacy fields (kept for backward compatibility)
  pointsMultiplier Float   @default(1.0) @map("points_multiplier")
  storeDiscount    Float   @default(0) @map("store_discount")
  pdvDiscount      Float   @default(0) @map("pdv_discount")
  spaceDiscount    Float   @default(0) @map("space_discount")
  verifiedBadge    Boolean @default(true) @map("verified_badge")

  isActive         Boolean @default(true) @map("is_active")
  subscribersCount Int     @default(0) @map("subscribers_count")

  stripeProductId String? @map("stripe_product_id")
  stripePriceId   String? @map("stripe_price_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  createdBy String?  @map("created_by")

  // Relations
  subscriptions UserSubscription[]
  history       SubscriptionHistory[]

  @@unique([associationId, name])
  @@map("subscription_plans")
}

enum SubscriptionStatus {
  ACTIVE
  SUSPENDED
  CANCELLED
  EXPIRED
}

model UserSubscription {
  id     String           @id @default(cuid())
  userId String           @map("user_id")
  user   User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  planId String           @map("plan_id")
  plan   SubscriptionPlan @relation(fields: [planId], references: [id])

  status             SubscriptionStatus @default(ACTIVE)
  subscribedAt       DateTime           @default(now()) @map("subscribed_at")
  currentPeriodStart DateTime           @map("current_period_start")
  currentPeriodEnd   DateTime           @map("current_period_end")

  // Cancellation
  cancelledAt  DateTime? @map("cancelled_at")
  cancelReason String?   @map("cancel_reason")

  // Suspension (by admin)
  suspendedAt   DateTime? @map("suspended_at")
  suspendedBy   String?   @map("suspended_by")
  suspendReason String?   @map("suspend_reason")

  stripeSubscriptionId String? @map("stripe_subscription_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  history SubscriptionHistory[]

  @@unique([userId]) // Only one subscription per user
  @@index([userId, status])
  @@map("user_subscriptions")
}

enum SubscriptionAction {
  SUBSCRIBED
  CHANGED
  CANCELLED
  SUSPENDED
  REACTIVATED
  RENEWED
}

model SubscriptionHistory {
  id             String            @id @default(cuid())
  userId         String            @map("user_id")
  subscriptionId String?           @map("subscription_id")
  subscription   UserSubscription? @relation(fields: [subscriptionId], references: [id])
  planId         String            @map("plan_id")
  plan           SubscriptionPlan  @relation(fields: [planId], references: [id])

  action      SubscriptionAction
  planName    String             @map("plan_name")
  details     Json? // { price, previous_plan, reason, etc }
  performedBy String             @map("performed_by") // user_id or admin_id

  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId, createdAt])
  @@map("subscription_history")
}

// ===========================================
// BADGES (Phase 2)
// ===========================================

model Badge {
  id          String  @id @default(cuid())
  name        String
  description String?
  iconUrl     String  @map("icon_url")

  // Criteria
  criteriaType  String @map("criteria_type") // events_count, points_earned, strava_km, etc
  criteriaValue Int    @map("criteria_value")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  users  UserBadge[]
  events Event[]

  @@map("badges")
}

model UserBadge {
  id      String @id @default(cuid())
  userId  String @map("user_id")
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  badgeId String @map("badge_id")
  badge   Badge  @relation(fields: [badgeId], references: [id])

  earnedAt   DateTime @default(now()) @map("earned_at")
  isFeatured Boolean  @default(false) @map("is_featured") // displayed on profile

  @@unique([userId, badgeId])
  @@map("user_badges")
}

// ===========================================
// MEMBER CARD (Phase 2)
// ===========================================

enum CardStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

model MemberCard {
  id     String @id @default(cuid())
  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  cardNumber   String     @unique @map("card_number") // e.g., "A-2024-00001"
  status       CardStatus @default(ACTIVE)
  statusReason String?    @map("status_reason") // Reason if inactive/suspended

  qrCodeHash String @map("qr_code_hash") // HMAC-SHA256 for validation
  qrCodeData String @map("qr_code_data") // JSON encoded QR data

  issuedAt  DateTime  @default(now()) @map("issued_at")
  expiresAt DateTime? @map("expires_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  // Relations
  usageLogs CardUsageLog[]

  @@map("member_cards")
}

// ===========================================
// PARTNERS & BENEFITS (Phase 2)
// ===========================================

model PartnerCategory {
  id            String      @id @default(cuid())
  associationId String      @map("association_id")
  association   Association @relation(fields: [associationId], references: [id])

  name     String // "Alimentação", "Saúde", etc.
  slug     String // "food", "health"
  icon     String  @default("gift") // Emoji or icon name
  color    String  @default("#6366F1")
  order    Int     @default(0)
  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  partners Partner[]

  @@unique([associationId, slug])
  @@map("partner_categories")
}

enum AudienceType {
  ALL
  SUBSCRIBERS
  NON_SUBSCRIBERS
  SPECIFIC_PLANS
}

model Partner {
  id            String          @id @default(cuid())
  associationId String          @map("association_id")
  association   Association     @relation(fields: [associationId], references: [id])
  categoryId    String          @map("category_id")
  category      PartnerCategory @relation(fields: [categoryId], references: [id])

  name         String
  logoUrl      String? @map("logo_url")
  bannerUrl    String? @map("banner_url")
  benefit      String // "15% de desconto em todos os produtos"
  instructions String? // "Apresente a carteirinha antes de fechar a conta"

  // Address
  street  String?
  city    String?
  state   String?
  zipCode String? @map("zip_code")
  lat     Float?
  lng     Float?

  // Contact
  phone     String?
  website   String?
  instagram String?
  facebook  String?
  whatsapp  String?

  // Business hours as JSON: { "monday": "11:00-23:00", ... }
  businessHours Json? @map("business_hours")

  // Audience targeting
  eligibleAudiences AudienceType[] @default([ALL]) @map("eligible_audiences")
  eligiblePlanIds   String[]       @default([]) @map("eligible_plan_ids")
  showLocked        Boolean        @default(true) @map("show_locked") // Show to ineligible users?

  isActive Boolean  @default(true) @map("is_active")
  isNew    Boolean  @default(true) @map("is_new") // "NOVO" badge
  addedAt  DateTime @default(now()) @map("added_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  usageLogs CardUsageLog[]

  @@index([associationId, categoryId])
  @@map("partners")
}

// ===========================================
// CARD USAGE LOG (Phase 2)
// ===========================================

enum CardUsageType {
  CHECKIN          // Check-in at association
  BENEFIT_USED     // Used at partner
  EVENT_VALIDATION // Validated at event
  QR_SCANNED       // General QR scan
}

model CardUsageLog {
  id        String      @id @default(cuid())
  cardId    String      @map("card_id")
  card      MemberCard  @relation(fields: [cardId], references: [id], onDelete: Cascade)
  userId    String      @map("user_id")
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  partnerId String?     @map("partner_id")
  partner   Partner?    @relation(fields: [partnerId], references: [id])

  type     CardUsageType
  location String? // Name of the location
  address  String? // Full address
  metadata Json?   // Extra data

  scannedAt DateTime @default(now()) @map("scanned_at")

  @@index([cardId, scannedAt])
  @@index([userId, scannedAt])
  @@map("card_usage_logs")
}

// ===========================================
// EVENTS (Phase 3)
// ===========================================

enum EventCategory {
  SOCIAL
  SPORTS
  CULTURAL
  EDUCATIONAL
  NETWORKING
  GASTRO
  MUSIC
  ART
  GAMES
  INSTITUTIONAL
}

enum EventStatus {
  DRAFT
  SCHEDULED
  ONGOING
  ENDED
  CANCELED
}

enum BadgeCriteria {
  FIRST_CHECKIN  // Award on first check-in only
  ALL_CHECKINS   // Award when all check-ins completed
  AT_LEAST_ONE   // Award when at least one check-in (default)
}

model Event {
  id            String      @id @default(cuid())
  associationId String      @map("association_id")
  association   Association @relation(fields: [associationId], references: [id])

  // Basic info
  title       String
  description String        @db.Text
  category    EventCategory
  color       String        @default("#6366F1")

  // Dates
  startDate DateTime @map("start_date")
  endDate   DateTime @map("end_date")

  // Location
  locationName    String  @map("location_name")
  locationAddress String? @map("location_address")

  // Images
  bannerFeed    String?  @map("banner_feed")
  bannerDisplay String[] @default([]) @map("banner_display")

  // Check-in config
  pointsTotal     Int @map("points_total")
  checkinsCount   Int @map("checkins_count")
  checkinInterval Int @default(30) @map("checkin_interval") // minutes between check-ins

  // Badge config
  badgeId       String?       @map("badge_id")
  badge         Badge?        @relation(fields: [badgeId], references: [id])
  badgeCriteria BadgeCriteria @default(AT_LEAST_ONE) @map("badge_criteria")

  // Status
  status       EventStatus @default(DRAFT)
  isPaused     Boolean     @default(false) @map("is_paused")
  cancelReason String?     @map("cancel_reason")

  // Optional
  capacity     Int?
  externalLink String? @map("external_link")

  // QR Code security
  qrSecret String @map("qr_secret")

  // Metadata
  createdBy   String    @map("created_by")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  publishedAt DateTime? @map("published_at")

  // Relations
  confirmations EventConfirmation[]
  checkIns      EventCheckIn[]
  comments      EventComment[]

  @@index([associationId, status])
  @@index([associationId, startDate])
  @@map("events")
}

model EventConfirmation {
  id      String @id @default(cuid())
  eventId String @map("event_id")
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId  String @map("user_id")
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  confirmedAt DateTime @default(now()) @map("confirmed_at")

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
  @@map("event_confirmations")
}

model EventCheckIn {
  id      String @id @default(cuid())
  eventId String @map("event_id")
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId  String @map("user_id")
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  checkinNumber Int     @map("checkin_number") // 1, 2, 3, etc.
  pointsAwarded Int     @map("points_awarded")
  badgeAwarded  Boolean @default(false) @map("badge_awarded")

  // For tracking manual check-ins
  isManual     Boolean @default(false) @map("is_manual")
  manualBy     String? @map("manual_by")
  manualReason String? @map("manual_reason")

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([eventId, userId, checkinNumber])
  @@index([eventId, createdAt])
  @@index([userId, createdAt])
  @@map("event_checkins")
}

model EventComment {
  id      String @id @default(cuid())
  eventId String @map("event_id")
  event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId  String @map("user_id")
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  text      String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([eventId, createdAt])
  @@map("event_comments")
}

// ===========================================
// NOTIFICATIONS (Phase 4)
// ===========================================

enum NotificationCategory {
  SOCIAL
  EVENTS
  POINTS
  RESERVATIONS
  SYSTEM
}

enum NotificationType {
  // Social (7 types)
  NEW_LIKE
  NEW_COMMENT
  COMMENT_REPLY
  MENTION
  NEW_FOLLOWER
  STORY_VIEW
  POLL_ENDED

  // Events (9 types)
  NEW_EVENT
  EVENT_REMINDER_1DAY
  EVENT_REMINDER_1HOUR
  EVENT_STARTED
  CHECKIN_REMINDER
  BADGE_EARNED
  EVENT_CANCELLED
  EVENT_UPDATED
  CHECKIN_PROGRESS

  // Points (5 types)
  POINTS_RECEIVED
  POINTS_SPENT
  RANKING_UP
  TRANSFER_RECEIVED
  STRAVA_SYNC

  // Reservations (4 types)
  RESERVATION_APPROVED
  RESERVATION_REJECTED
  RESERVATION_REMINDER
  WAITLIST_AVAILABLE

  // System (5 types)
  NEW_MESSAGE
  NEW_BENEFIT
  CARD_BLOCKED
  CARD_UNBLOCKED
  ADMIN_ANNOUNCEMENT
}

enum DevicePlatform {
  IOS
  ANDROID
  WEB
}

model Notification {
  id     String @id @default(cuid())
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  type      NotificationType
  category  NotificationCategory
  title     String
  body      String
  data      Json?   // Extra payload data
  imageUrl  String? @map("image_url")
  actionUrl String? @map("action_url")
  groupKey  String? @map("group_key") // For batching similar notifications

  isRead    Boolean  @default(false) @map("is_read")
  readAt    DateTime? @map("read_at")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId, isRead])
  @@index([userId, category])
  @@index([userId, createdAt])
  @@index([groupKey])
  @@map("notifications")
}

model NotificationSettings {
  id       String               @id @default(cuid())
  userId   String               @map("user_id")
  user     User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  category NotificationCategory

  pushEnabled  Boolean @default(true) @map("push_enabled")
  inAppEnabled Boolean @default(true) @map("in_app_enabled")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, category])
  @@map("notification_settings")
}

model DoNotDisturbSettings {
  id     String @id @default(cuid())
  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  enabled    Boolean @default(false)
  startTime  String? @map("start_time") // "22:00" format
  endTime    String? @map("end_time")   // "07:00" format
  daysOfWeek Int[]   @default([]) @map("days_of_week") // 0=Sunday, 6=Saturday

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("do_not_disturb_settings")
}

model DeviceToken {
  id       String         @id @default(cuid())
  userId   String         @map("user_id")
  user     User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  token    String         @unique
  platform DevicePlatform

  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@map("device_tokens")
}

// ===========================================
// MESSAGES (Phase 4)
// ===========================================

enum ConversationType {
  DIRECT
  GROUP
}

enum ConversationRole {
  MEMBER
  ADMIN
}

enum MessageContentType {
  TEXT
  IMAGE
  AUDIO
}

enum MessageStatus {
  SENDING
  SENT
  DELIVERED
  READ
}

model Conversation {
  id   String           @id @default(cuid())
  type ConversationType

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  participants ConversationParticipant[]
  messages     Message[]
  group        ConversationGroup?

  @@map("conversations")
}

model ConversationParticipant {
  id             String           @id @default(cuid())
  conversationId String           @map("conversation_id")
  conversation   Conversation     @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  userId         String           @map("user_id")
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  role       ConversationRole @default(MEMBER)
  isMuted    Boolean          @default(false) @map("is_muted")
  isArchived Boolean          @default(false) @map("is_archived")
  lastReadAt DateTime?        @map("last_read_at")
  joinedAt   DateTime         @default(now()) @map("joined_at")
  leftAt     DateTime?        @map("left_at")

  @@unique([conversationId, userId])
  @@index([userId, isArchived])
  @@map("conversation_participants")
}

model ConversationGroup {
  id             String       @id @default(cuid())
  conversationId String       @unique @map("conversation_id")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  name        String
  description String?
  imageUrl    String? @map("image_url")

  createdById String @map("created_by_id")
  createdBy   User   @relation(fields: [createdById], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("conversation_groups")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String       @map("conversation_id")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  senderId       String       @map("sender_id")
  sender         User         @relation(fields: [senderId], references: [id], onDelete: Cascade)

  content     String           @db.Text
  contentType MessageContentType @default(TEXT) @map("content_type")
  mediaUrl    String?          @map("media_url")

  // Reply reference
  replyToId String?  @map("reply_to_id")
  replyTo   Message? @relation("MessageReplies", fields: [replyToId], references: [id])
  replies   Message[] @relation("MessageReplies")

  status    MessageStatus @default(SENT)
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")
  deletedAt DateTime?     @map("deleted_at")

  // Relations
  reactions MessageReaction[]

  @@index([conversationId, createdAt])
  @@index([senderId])
  @@map("messages")
}

model MessageReaction {
  id        String  @id @default(cuid())
  messageId String  @map("message_id")
  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  userId    String  @map("user_id")
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  emoji     String
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([messageId, userId, emoji])
  @@map("message_reactions")
}

// ===========================================
// PDV SYSTEM (Phase 5 - MVP)
// ===========================================

enum PdvStatus {
  ACTIVE
  INACTIVE
  MAINTENANCE
}

enum PdvCheckoutStatus {
  PENDING      // Aguardando scan do QR
  AWAITING_PIX // Usuário escolheu PIX, aguardando pagamento
  PAID         // Pagamento confirmado
  EXPIRED      // QR expirou
  CANCELLED    // Cancelado
}

enum PdvPaymentMethod {
  POINTS
  PIX
}

model Pdv {
  id            String      @id @default(cuid())
  associationId String      @map("association_id")

  name     String
  location String
  status   PdvStatus @default(ACTIVE)

  // Display config (JSON)
  displayConfig Json @default("{}") @map("display_config")
  // { theme: "default", idle_timeout: 60, checkout_timeout: 300 }

  // Authentication for kiosk
  apiKey    String @unique @map("api_key")
  apiSecret String @map("api_secret") // hashed

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  products  PdvProduct[]
  checkouts PdvCheckout[]
  sales     PdvSale[]

  @@index([associationId, status])
  @@map("pdvs")
}

model PdvProduct {
  id    String @id @default(cuid())
  pdvId String @map("pdv_id")
  pdv   Pdv    @relation(fields: [pdvId], references: [id], onDelete: Cascade)

  name        String
  description String?
  imageUrl    String?  @map("image_url")
  pricePoints Int      @map("price_points")
  priceMoney  Decimal  @map("price_money") @db.Decimal(10, 2)
  category    String?
  stock       Int      @default(0)
  isActive    Boolean  @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([pdvId, isActive])
  @@map("pdv_products")
}

model PdvCheckout {
  id    String @id @default(cuid())
  code  String @unique // 6-char alphanumeric
  pdvId String @map("pdv_id")
  pdv   Pdv    @relation(fields: [pdvId], references: [id])

  items       Json // Array of { product_id, name, quantity, unit_price_points, unit_price_money }
  totalPoints Int  @map("total_points")
  totalMoney  Decimal @map("total_money") @db.Decimal(10, 2)

  paymentMethod PdvPaymentMethod?  @map("payment_method")
  status        PdvCheckoutStatus @default(PENDING)

  // QR Code data
  qrCodeUrl String? @map("qr_code_url")

  // Stripe PIX
  stripePaymentIntentId String?   @map("stripe_payment_intent_id")
  pixQrCode             String?   @map("pix_qr_code") @db.Text
  pixExpiresAt          DateTime? @map("pix_expires_at")

  // User who paid
  paidByUserId String?   @map("paid_by_user_id")
  paidAt       DateTime? @map("paid_at")

  // Cashback (if PIX)
  cashbackEarned Int? @map("cashback_earned")

  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  sale PdvSale?

  @@index([pdvId, status])
  @@index([code])
  @@map("pdv_checkouts")
}

model PdvSale {
  id         String      @id @default(cuid())
  checkoutId String      @unique @map("checkout_id")
  checkout   PdvCheckout @relation(fields: [checkoutId], references: [id])
  pdvId      String      @map("pdv_id")
  pdv        Pdv         @relation(fields: [pdvId], references: [id])
  userId     String      @map("user_id")

  items         Json
  paymentMethod PdvPaymentMethod @map("payment_method")
  totalPoints   Int?             @map("total_points")
  totalMoney    Decimal?         @map("total_money") @db.Decimal(10, 2)

  // Transaction references
  pointsTransactionId   String? @map("points_transaction_id")
  stripePaymentId       String? @map("stripe_payment_id")
  cashbackEarned        Int?    @map("cashback_earned")
  cashbackTransactionId String? @map("cashback_transaction_id")

  // Linked order
  orderId String? @unique @map("order_id")
  order   Order?  @relation(fields: [orderId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")

  @@index([pdvId, createdAt])
  @@index([userId])
  @@map("pdv_sales")
}

// ===========================================
// STORE SYSTEM (Phase 5)
// ===========================================

model StoreCategory {
  id            String @id @default(cuid())
  associationId String @map("association_id")

  name         String
  slug         String
  description  String?
  imageUrl     String? @map("image_url")
  displayOrder Int     @default(0) @map("display_order")
  isActive     Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  products StoreProduct[]

  @@unique([associationId, slug])
  @@map("store_categories")
}

enum ProductType {
  PHYSICAL
  VOUCHER
  SERVICE
}

enum PaymentOptions {
  POINTS_ONLY
  MONEY_ONLY
  BOTH
}

model StoreProduct {
  id         String        @id @default(cuid())
  categoryId String        @map("category_id")
  category   StoreCategory @relation(fields: [categoryId], references: [id])

  name             String
  slug             String      @unique
  shortDescription String?     @map("short_description")
  longDescription  String?     @map("long_description") @db.Text
  type             ProductType @default(PHYSICAL)

  // Pricing
  pricePoints       Int?           @map("price_points")
  priceMoney        Decimal?       @map("price_money") @db.Decimal(10, 2)
  paymentOptions    PaymentOptions @default(BOTH) @map("payment_options")
  allowMixedPayment Boolean        @default(true) @map("allow_mixed_payment")

  // Stock
  stockType    String @default("limited") @map("stock_type") // "limited" | "unlimited"
  stockCount   Int?   @map("stock_count")
  limitPerUser Int?   @map("limit_per_user")

  // Cashback
  cashbackPercent Decimal? @map("cashback_percent") @db.Decimal(5, 2)

  // Voucher specific
  voucherValidityDays Int? @map("voucher_validity_days")

  // Featured & Promotions
  isFeatured             Boolean   @default(false) @map("is_featured")
  isPromotional          Boolean   @default(false) @map("is_promotional")
  promotionalPricePoints Int?      @map("promotional_price_points")
  promotionalPriceMoney  Decimal?  @map("promotional_price_money") @db.Decimal(10, 2)
  promotionalEndsAt      DateTime? @map("promotional_ends_at")

  // Restrictions
  eligiblePlans String[] @default([]) @map("eligible_plans")

  // Location
  pickupLocation String? @map("pickup_location")

  // Stats
  averageRating Decimal? @map("average_rating") @db.Decimal(2, 1)
  reviewCount   Int      @default(0) @map("review_count")
  soldCount     Int      @default(0) @map("sold_count")

  isActive Boolean @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  variants       ProductVariant[]
  images         ProductImage[]
  specifications ProductSpecification[]
  reviews        ProductReview[]
  favorites      ProductFavorite[]
  cartItems      CartItem[]

  @@index([categoryId, isActive])
  @@map("store_products")
}

model ProductVariant {
  id        String       @id @default(cuid())
  productId String       @map("product_id")
  product   StoreProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  sku        String  @unique
  name       String // "M - Azul"
  attributes Json // { size: "M", color: "Azul" }

  pricePoints Int?     @map("price_points") // Override
  priceMoney  Decimal? @map("price_money") @db.Decimal(10, 2)
  stockCount  Int      @default(0) @map("stock_count")
  imageUrl    String?  @map("image_url")
  isActive    Boolean  @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cartItems CartItem[]

  @@index([productId])
  @@map("product_variants")
}

model ProductImage {
  id        String       @id @default(cuid())
  productId String       @map("product_id")
  product   StoreProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  url          String
  altText      String? @map("alt_text")
  displayOrder Int     @default(0) @map("display_order")

  createdAt DateTime @default(now()) @map("created_at")

  @@index([productId])
  @@map("product_images")
}

model ProductSpecification {
  id        String       @id @default(cuid())
  productId String       @map("product_id")
  product   StoreProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  key          String
  value        String
  displayOrder Int @default(0) @map("display_order")

  createdAt DateTime @default(now()) @map("created_at")

  @@map("product_specifications")
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

model ProductReview {
  id        String       @id @default(cuid())
  productId String       @map("product_id")
  product   StoreProduct @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId    String       @map("user_id")
  orderId   String       @map("order_id")

  rating  Int // 1-5
  comment String? @db.Text
  status  ReviewStatus @default(PENDING)

  moderatedBy String?   @map("moderated_by")
  moderatedAt DateTime? @map("moderated_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([productId, userId, orderId])
  @@map("product_reviews")
}

model ProductFavorite {
  id        String       @id @default(cuid())
  userId    String       @map("user_id")
  productId String       @map("product_id")
  product   StoreProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, productId])
  @@index([userId])
  @@map("product_favorites")
}

model Cart {
  id     String @id @default(cuid())
  userId String @unique @map("user_id")

  subtotalPoints Int      @default(0) @map("subtotal_points")
  subtotalMoney  Decimal  @default(0) @map("subtotal_money") @db.Decimal(10, 2)
  reservedUntil  DateTime? @map("reserved_until")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items CartItem[]

  @@map("carts")
}

model CartItem {
  id        String          @id @default(cuid())
  cartId    String          @map("cart_id")
  cart      Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId String          @map("product_id")
  product   StoreProduct    @relation(fields: [productId], references: [id])
  variantId String?         @map("variant_id")
  variant   ProductVariant? @relation(fields: [variantId], references: [id])

  quantity        Int
  unitPricePoints Int     @map("unit_price_points")
  unitPriceMoney  Decimal @map("unit_price_money") @db.Decimal(10, 2)
  reservedStock   Boolean @default(false) @map("reserved_stock")

  addedAt DateTime @default(now()) @map("added_at")

  @@unique([cartId, productId, variantId])
  @@map("cart_items")
}

// ===========================================
// ORDERS SYSTEM (Phase 5 - Shared)
// ===========================================

enum OrderSource {
  STORE
  PDV
}

enum OrderStatus {
  PENDING   // Pago, aguardando processamento
  CONFIRMED // Em separação
  READY     // Pronto para retirada
  COMPLETED // Entregue
  CANCELLED // Cancelado
}

enum OrderPaymentMethod {
  POINTS
  MONEY
  MIXED
}

model Order {
  id     String @id @default(cuid())
  code   String @unique // 6-char alphanumeric
  userId String @map("user_id")

  source     OrderSource
  sourceId   String      @map("source_id") // checkout_id or sale_id
  sourceName String      @map("source_name") // "Loja Online" or PDV name

  // Totals
  subtotalPoints Int     @map("subtotal_points")
  subtotalMoney  Decimal @map("subtotal_money") @db.Decimal(10, 2)

  // Payment
  paymentMethod   OrderPaymentMethod @map("payment_method")
  pointsUsed      Int?               @map("points_used")
  moneyPaid       Decimal?           @map("money_paid") @db.Decimal(10, 2)
  cashbackEarned  Int?               @map("cashback_earned")
  stripePaymentId String?            @map("stripe_payment_id")

  // Transaction references
  pointsTransactionId   String? @map("points_transaction_id")
  cashbackTransactionId String? @map("cashback_transaction_id")

  // Status
  status OrderStatus @default(PENDING)

  // Pickup
  pickupCode     String  @map("pickup_code") // QR code data
  pickupLocation String? @map("pickup_location")

  // Cancellation
  cancelledBy     String?   @map("cancelled_by")
  cancelledReason String?   @map("cancelled_reason")
  cancelledAt     DateTime? @map("cancelled_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  items         OrderItem[]
  statusHistory OrderStatusHistory[]
  receipt       OrderReceipt?
  pdvSale       PdvSale?

  @@index([userId, createdAt])
  @@index([status])
  @@map("orders")
}

enum OrderItemType {
  PHYSICAL
  VOUCHER
  SERVICE
}

model OrderItem {
  id      String @id @default(cuid())
  orderId String @map("order_id")
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId    String  @map("product_id")
  variantId    String? @map("variant_id")
  productName  String  @map("product_name")
  variantName  String? @map("variant_name")
  productImage String? @map("product_image")

  quantity        Int
  unitPricePoints Int     @map("unit_price_points")
  unitPriceMoney  Decimal @map("unit_price_money") @db.Decimal(10, 2)
  totalPoints     Int     @map("total_points")
  totalMoney      Decimal @map("total_money") @db.Decimal(10, 2)

  type OrderItemType @default(PHYSICAL)

  // Voucher fields
  voucherCode      String?   @map("voucher_code")
  voucherUsed      Boolean   @default(false) @map("voucher_used")
  voucherUsedAt    DateTime? @map("voucher_used_at")
  voucherExpiresAt DateTime? @map("voucher_expires_at")

  createdAt DateTime @default(now()) @map("created_at")

  @@map("order_items")
}

model OrderStatusHistory {
  id      String @id @default(cuid())
  orderId String @map("order_id")
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  status        OrderStatus
  changedBy     String?     @map("changed_by")
  changedByName String?     @map("changed_by_name")
  notes         String?

  createdAt DateTime @default(now()) @map("created_at")

  @@index([orderId, createdAt])
  @@map("order_status_history")
}

model OrderReceipt {
  id      String @id @default(cuid())
  orderId String @unique @map("order_id")
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  receiptNumber String @unique @map("receipt_number") // REC-2026-000001
  data          Json // Full receipt data snapshot

  createdAt DateTime @default(now()) @map("created_at")

  @@map("order_receipts")
}

// ===========================================
// SPACES SYSTEM (Phase 6)
// ===========================================

enum SpaceStatus {
  ACTIVE
  MAINTENANCE
  INACTIVE
}

enum BookingPeriodType {
  DAY   // Dia inteiro
  SHIFT // Por turno (manhã, tarde, noite)
  HOUR  // Por hora
}

model Space {
  id            String      @id @default(cuid())
  associationId String      @map("association_id")

  name        String
  description String   @db.Text
  capacity    Int

  // Images
  images       String[] @default([])
  mainImageUrl String?  @map("main_image_url")

  // Pricing (0 = free)
  fee Decimal @default(0) @db.Decimal(10, 2)

  // Booking period config
  periodType BookingPeriodType @default(DAY) @map("period_type")

  // For SHIFT period - JSON array of { name, startTime, endTime }
  // e.g., [{ "name": "Manhã", "startTime": "08:00", "endTime": "12:00" }]
  shifts Json? @default("[]")

  // For HOUR period
  openingTime     String? @map("opening_time")  // "08:00"
  closingTime     String? @map("closing_time")  // "22:00"
  minDurationHours Int?   @map("min_duration_hours")

  // Booking rules
  minAdvanceDays Int @default(1) @map("min_advance_days") // Min days to book in advance
  maxAdvanceDays Int @default(60) @map("max_advance_days") // Max days to book in advance

  // Interval between bookings for same user (in months, 0 = no restriction)
  bookingIntervalMonths Int @default(0) @map("booking_interval_months")

  // Related spaces that get blocked when this space is booked
  blockedSpaceIds String[] @default([]) @map("blocked_space_ids")

  status SpaceStatus @default(ACTIVE)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at") // Soft delete

  // Relations
  blocks    SpaceBlock[]
  bookings  Booking[]

  @@index([associationId, status])
  @@map("spaces")
}

model SpaceBlock {
  id      String @id @default(cuid())
  spaceId String @map("space_id")
  space   Space  @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  date   DateTime @db.Date
  reason String?

  createdById String @map("created_by_id")

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([spaceId, date])
  @@index([spaceId, date])
  @@map("space_blocks")
}

// ===========================================
// BOOKINGS SYSTEM (Phase 6)
// ===========================================

enum BookingStatus {
  PENDING   // Aguardando aprovação
  APPROVED  // Aprovada
  REJECTED  // Rejeitada
  CANCELLED // Cancelada
  EXPIRED   // Expirada (não aprovada a tempo)
  COMPLETED // Concluída (data passou)
}

model Booking {
  id      String @id @default(cuid())
  spaceId String @map("space_id")
  space   Space  @relation(fields: [spaceId], references: [id])
  userId  String @map("user_id")

  // Booking date/time
  date       DateTime @db.Date
  periodType BookingPeriodType @map("period_type")

  // For SHIFT bookings
  shiftName  String? @map("shift_name")  // "Manhã", "Tarde", "Noite"
  shiftStart String? @map("shift_start") // "08:00"
  shiftEnd   String? @map("shift_end")   // "12:00"

  // For HOUR bookings
  startTime String? @map("start_time") // "14:00"
  endTime   String? @map("end_time")   // "18:00"

  // Pricing
  totalFee      Decimal? @map("total_fee") @db.Decimal(10, 2)
  discountApplied Decimal? @map("discount_applied") @db.Decimal(5, 2) // From subscription
  finalFee      Decimal? @map("final_fee") @db.Decimal(10, 2)

  status BookingStatus @default(PENDING)

  // Approval/Rejection
  approvedById  String?   @map("approved_by_id")
  approvedAt    DateTime? @map("approved_at")
  rejectedById  String?   @map("rejected_by_id")
  rejectedAt    DateTime? @map("rejected_at")
  rejectionReason String? @map("rejection_reason")

  // Cancellation
  cancelledById    String?   @map("cancelled_by_id")
  cancelledAt      DateTime? @map("cancelled_at")
  cancellationReason String? @map("cancellation_reason")

  // Expiration
  expiredAt DateTime? @map("expired_at")

  // Completion
  completedAt DateTime? @map("completed_at")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  waitlistEntries BookingWaitlist[]

  @@unique([spaceId, date, periodType, shiftName, startTime])
  @@index([spaceId, date, status])
  @@index([userId, createdAt])
  @@index([status])
  @@map("bookings")
}

model BookingWaitlist {
  id        String   @id @default(cuid())
  spaceId   String   @map("space_id")
  bookingId String?  @map("booking_id") // The booking they're waiting for
  booking   Booking? @relation(fields: [bookingId], references: [id], onDelete: SetNull)
  userId    String   @map("user_id")

  // Booking details they want
  date       DateTime @db.Date
  periodType BookingPeriodType @map("period_type")
  shiftName  String? @map("shift_name")
  startTime  String? @map("start_time")
  endTime    String? @map("end_time")

  position Int // Queue position

  // Notification tracking
  notifiedAt    DateTime? @map("notified_at")
  expiresAt     DateTime? @map("expires_at") // 24h after notification
  respondedAt   DateTime? @map("responded_at")
  accepted      Boolean?  // true = accepted, false = declined, null = no response

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([spaceId, date, periodType, shiftName, startTime, userId])
  @@index([spaceId, date])
  @@index([userId])
  @@map("booking_waitlist")
}
